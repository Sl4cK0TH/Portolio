<!DOCTYPE html>
<html lang="en" data-site-base="/">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Achievements</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="../assets/css/achievements.css"> <!-- New stylesheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Fira+Code:wght@400;700&display=swap"
        rel="stylesheet">
    <!-- CDN for marked.js to parse Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
    <div id="header-placeholder"></div>

    <main>
        <section class="achievements-section">
            <div class="achievements-container">
                <h1 class="section-title">./achievements</h1>
                <div id="achievements-grid" class="achievements-grid">
                    <!-- Achievement cards will be injected here by JavaScript -->
                </div>
            </div>
        </section>
    </main>

    <!-- Modal Structure (hidden by default) -->
    <div id="achievement-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <button id="modal-close" class="modal-close-btn">&times;</button>
            <div id="modal-body" class="modal-body-content">
                <!-- Markdown content will be injected here -->
            </div>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <script src="../assets/js/componentLoader.js" defer></script>
    <script src="../assets/js/main.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const grid = document.getElementById('achievements-grid');
            const modal = document.getElementById('achievement-modal');
            const modalBody = document.getElementById('modal-body');
            const modalCloseBtn = document.getElementById('modal-close');

            if (!grid || !modal) return;

            // Fetch achievements from JSON data file
            let achievementsData = [];
            try {
                const response = await fetch('../data/achievements.json');
                if (!response.ok) throw new Error('Failed to load achievements');
                achievementsData = await response.json();
            } catch (error) {
                console.error('Error loading achievements:', error);
                grid.innerHTML = '<p style="font-family: \'Fira Code\';">Failed to load achievements. Please try again later.</p>';
                return;
            }

            // --- 1. Generate Achievement Cards ---
            let cardsHtml = '';
            if (achievementsData.length > 0) {
                achievementsData.forEach((achievement, index) => {
                    cardsHtml += `
                        <div class="achievement-card" data-index="${index}">
                            <img src="../${achievement.image}" alt="${achievement.title}" class="card-image">
                            <div class="card-title">${achievement.title}</div>
                        </div>
                    `;
                });
                grid.innerHTML = cardsHtml;
            } else {
                grid.innerHTML = '<p style="font-family: \'Fira Code\';">No achievements listed yet.</p>';
            }

            // --- 2. Setup Modal Logic ---
            const cards = document.querySelectorAll('.achievement-card');

            cards.forEach(card => {
                card.addEventListener('click', () => {
                    const index = card.getAttribute('data-index');
                    const achievement = achievementsData[index];

                    // Build modal content from JSON data
                    const modalContent = `
                        <img src="../${achievement.image}" alt="${achievement.title}" class="modal-main-image">
                        <h1>${achievement.title}</h1>
                        <p><strong>Date:</strong> ${achievement.date || 'N/A'}</p>
                        <p><strong>Issued By:</strong> ${achievement.issuedBy || 'N/A'}</p>
                        <p>${achievement.description || ''}</p>
                        ${achievement.credentialId ? `<p><strong>Credential ID:</strong> ${achievement.credentialId}</p>` : ''}
                        ${achievement.credentialLink ? `<p><a href="${achievement.credentialLink}" target="_blank" rel="noopener">View Certificate</a></p>` : ''}
                    `;

                    modalBody.innerHTML = modalContent;
                    modal.style.display = 'flex';
                });
            });

            // Function to close the modal
            const closeModal = () => {
                modal.style.display = 'none';
                modalBody.innerHTML = ''; // Clear content
            };

            // Event listeners to close the modal
            modalCloseBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (event) => {
                // Close if the overlay (the modal itself) is clicked, but not its children
                if (event.target === modal) {
                    closeModal();
                }
            });
        });
    </script>
</body>

</html>